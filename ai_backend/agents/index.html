<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Workflows Overview - Regulatory AI Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Regulatory AI Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../getting-started/" class="nav-link">Getting Started</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../api/design_template/template_api/" class="dropdown-item">Design Template API</a>
</li>
                                    
<li>
    <a href="../../api/gspr_table/gspr_table_api/" class="dropdown-item">GSPR Table API</a>
</li>
                                    
<li>
    <a href="../../api/design_input/design_input/" class="dropdown-item">Design Input API</a>
</li>
                                    
<li>
    <a href="../../api/design_output/design_output/" class="dropdown-item">Design Output API</a>
</li>
                                    
<li>
    <a href="../../api/projects/projects_api/" class="dropdown-item">Projects API</a>
</li>
                                    
<li>
    <a href="../../api/session/session_api/" class="dropdown-item">Sessions API</a>
</li>
                                    
<li>
    <a href="../../api/other_api/other_api/" class="dropdown-item">Other APIs</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Database & Schemas</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../database_and_schemas/databases_overview/" class="dropdown-item">Databases Overview</a>
</li>
                                    
<li>
    <a href="../../database_and_schemas/schemas/" class="dropdown-item">APIs Response Schemas</a>
</li>
                                    
<li>
    <a href="../../database_and_schemas/other/" class="dropdown-item">Other</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">AI Backend</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../chains_overview/" class="dropdown-item">Chains Overview</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Workflows Overview</a>
</li>
                                    
<li>
    <a href="../graphs/" class="dropdown-item">Graph Nodes</a>
</li>
                                    
<li>
    <a href="../output_models/" class="dropdown-item">Output Models</a>
</li>
                                    
<li>
    <a href="../prompts/" class="dropdown-item">Prompts</a>
</li>
                                    
<li>
    <a href="../others/" class="dropdown-item">Other Modules</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../faq/" class="nav-link">FAQ</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../chains_overview/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../graphs/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#core-agents-intelligent-regulatory-automation-modules" class="nav-link">üñ•Ô∏è Core Agents ‚Äî Intelligent Regulatory Automation Modules</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#fda-name-agent-map-device-names-to-fda-terminology" class="nav-link">üè• FDA Name Agent ‚Äî Map Device Names to FDA Terminology</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.FDA_nameAgent" class="nav-link">FDA_nameAgent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.FDA_nameAgent.FDAAgent" class="nav-link">FDAAgent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#gspr-table-agent-build-maintain-compliance-tables" class="nav-link">üìä GSPR Table Agent ‚Äî Build &amp; Maintain Compliance Tables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.gspr_tableAgent" class="nav-link">gspr_tableAgent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.gspr_tableAgent--project-regulatory-ai-backend" class="nav-link">Project: Regulatory AI Backend</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.gspr_tableAgent--description-gsprtableagent-orchestrates-the-gspr-generation-workflow-using-langtable" class="nav-link">Description: GSPRTableAgent orchestrates the GSPR generation workflow using LangTable.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.gspr_tableAgent.GSPRGraphRunner" class="nav-link">GSPRGraphRunner</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#regulatory-guard-agent-rule-based-safety-compliance-validation" class="nav-link">üõ°Ô∏è Regulatory Guard Agent ‚Äî Rule-Based Safety &amp; Compliance Validation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.regulatory_guard_agent" class="nav-link">regulatory_guard_agent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.regulatory_guard_agent.system_instructions" class="nav-link">system_instructions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#core.agent.regulatory_guard_agent.get_regulatory_guard_agent" class="nav-link">get_regulatory_guard_agent</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="core-agents-intelligent-regulatory-automation-modules">üñ•Ô∏è Core Agents ‚Äî Intelligent Regulatory Automation Modules</h1>
<hr />
<h2 id="fda-name-agent-map-device-names-to-fda-terminology">üè• FDA Name Agent ‚Äî Map Device Names to FDA Terminology</h2>
<p>Automatically interprets user-provided device names and maps them to official <strong>FDA-recognized nomenclature</strong>.<br />
Supports classification, regulatory lookup, and component selection with high accuracy üß†üìö.</p>


<div class="doc doc-object doc-module">



<a id="core.agent.FDA_nameAgent"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="core.agent.FDA_nameAgent.FDAAgent" class="doc doc-heading">
            <code>FDAAgent</code>


</h2>


    <div class="doc doc-contents ">



        <p>Initialize the FDAAgent for device name suggestions.</p>
<p>The FDAAgent integrates with OpenAI embeddings and a Milvus vector store to provide
device name suggestions based on similarity search and language model processing.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required environment variables (OPENAI_API_KEY, MILVUS_COLLECTION,</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>core/agent/FDA_nameAgent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FDAAgent</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the FDAAgent for device name suggestions.</span>

<span class="sd">    The FDAAgent integrates with OpenAI embeddings and a Milvus vector store to provide</span>
<span class="sd">    device name suggestions based on similarity search and language model processing.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If required environment variables (OPENAI_API_KEY, MILVUS_COLLECTION,</span>
<span class="sd">        MILVUS_HOST/URI, MILVUS_PORT) are not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span> <span class="k">if</span> <span class="n">api_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">collection_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MILVUS_COLLECTION&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">collection_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MILVUS_COLLECTION environment variable is not set.&quot;</span><span class="p">)</span>

        <span class="c1"># Prefer full URI if explicitly provided</span>
        <span class="n">milvus_uri</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MILVUS_URI&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">milvus_uri</span><span class="p">:</span>
            <span class="n">milvus_host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MILVUS_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">milvus_host</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MILVUS_HOST environment variable is not set.&quot;</span><span class="p">)</span>
            <span class="n">milvus_port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MILVUS_PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;19530&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">milvus_port</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MILVUS_PORT environment variable is not set.&quot;</span><span class="p">)</span>
            <span class="n">milvus_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">milvus_host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">milvus_port</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span> <span class="o">=</span> <span class="n">Milvus</span><span class="p">(</span>
            <span class="n">embedding_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="n">connection_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">milvus_uri</span><span class="p">},</span>
            <span class="n">auto_id</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Set to True to match previous script behavior</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve device name suggestions based on input criteria.</span>

<span class="sd">    This method performs a similarity search in the Milvus vector store using the provided</span>
<span class="sd">    device name, then refines the results using a language model to generate structured</span>
<span class="sd">    suggestions.</span>

<span class="sd">    Args:</span>
<span class="sd">        device_name (str): The name of the device to search for.</span>
<span class="sd">        intended_purpose (str): The intended purpose of the device.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing a list of relevant device names.</span>

<span class="sd">    Example:</span>
<span class="sd">        agent = FDAAgent()</span>
<span class="sd">        suggestions = agent.get_suggestions(&quot;Pacemaker&quot;, &quot;Heart rhythm management&quot;)</span>

<span class="sd">        Response:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;relevant_device_names&quot;: [&quot;Cardiac Pacemaker&quot;, &quot;Implantable Pacemaker&quot;]</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">intended_purpose</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_store</span><span class="o">.</span><span class="n">similarity_search</span><span class="p">(</span><span class="n">device_name</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;relevant_device_names&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># Extract device names</span>
        <span class="n">device_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_name&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">page_content</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
                <span class="n">device_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Pass both device_name &amp; intended_purpose to LLM</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">FDA_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">device_name</span><span class="o">=</span><span class="n">device_name</span><span class="p">,</span>
            <span class="n">intended_purpose</span><span class="o">=</span><span class="n">intended_purpose</span><span class="p">,</span>
            <span class="n">device_names</span><span class="o">=</span><span class="n">device_names</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">structured_llm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">DeviceSuggestion</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">structured_llm</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h2 id="gspr-table-agent-build-maintain-compliance-tables">üìä GSPR Table Agent ‚Äî Build &amp; Maintain Compliance Tables</h2>
<p>Generates structured <strong>GSPR compliance tables</strong>, aligning clauses with evidence, standards, and device parameters.<br />
Ensures traceability and MDR-ready documentation for audits and submissions üìÑüîç.</p>


<div class="doc doc-object doc-module">



<a id="core.agent.gspr_tableAgent"></a>
    <div class="doc doc-contents first">

        <h2 id="core.agent.gspr_tableAgent--project-regulatory-ai-backend">Project: Regulatory AI Backend</h2>
<h2 id="core.agent.gspr_tableAgent--description-gsprtableagent-orchestrates-the-gspr-generation-workflow-using-langtable">Description: GSPRTableAgent orchestrates the GSPR generation workflow using LangTable.</h2>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="core.agent.gspr_tableAgent.GSPRGraphRunner" class="doc doc-heading">
            <code>GSPRGraphRunner</code>


</h2>


    <div class="doc doc-contents ">



        <p>GSPRGraphRunner orchestrates the full GSPR generation workflow via GSPRGraph.</p>
<p>It bridges FastAPI's background job system with the LLM-based regulatory
reasoning pipeline defined under <code>src/regulatory</code>.</p>
<p>Responsibilities:
- Fetch context &amp; state from Redis session
- Execute LangGraph-based bulk generation for all sections
- Publish real-time job progress via Redis Pub/Sub
- Handle failures and provide comprehensive results</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>session_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the Redis session.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>job_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the job.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>component_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the component being processed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>requirement_sections</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Requirement sections to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>concurrency_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of concurrent tasks (default: 15).</p>
              </div>
            </td>
            <td>
                  <code>15</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>core/agent/gspr_tableAgent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GSPRGraphRunner</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GSPRGraphRunner orchestrates the full GSPR generation workflow via GSPRGraph.</span>

<span class="sd">    It bridges FastAPI&#39;s background job system with the LLM-based regulatory</span>
<span class="sd">    reasoning pipeline defined under `src/regulatory`.</span>

<span class="sd">    Responsibilities:</span>
<span class="sd">    - Fetch context &amp; state from Redis session</span>
<span class="sd">    - Execute LangGraph-based bulk generation for all sections</span>
<span class="sd">    - Publish real-time job progress via Redis Pub/Sub</span>
<span class="sd">    - Handle failures and provide comprehensive results</span>

<span class="sd">    Args:</span>
<span class="sd">        session_id (str): Unique identifier for the Redis session.</span>
<span class="sd">        job_id (str): Unique identifier for the job.</span>
<span class="sd">        component_name (str): Name of the component being processed.</span>
<span class="sd">        requirement_sections (dict): Requirement sections to process.</span>
<span class="sd">        concurrency_limit (int): Maximum number of concurrent tasks (default: 15).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">job_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">requirement_sections</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
        <span class="n">concurrency_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="n">job_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span> <span class="o">=</span> <span class="n">get_job_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span> <span class="o">=</span> <span class="n">get_session_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">concurrency_limit</span> <span class="o">=</span> <span class="n">concurrency_limit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_name</span> <span class="o">=</span> <span class="n">component_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirement_sections</span> <span class="o">=</span> <span class="n">requirement_sections</span>

    <span class="c1"># ------------------------------------------------------------</span>
    <span class="c1"># Bulk processing for all sections at once</span>
    <span class="c1"># ------------------------------------------------------------</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_all_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the LangGraph workflow for all sections.</span>

<span class="sd">        This method processes all sections through the GSPRGraph pipeline, updates job progress,</span>
<span class="sd">        and returns the results along with metadata such as processing duration and counts of</span>
<span class="sd">        completed, failed, and skipped sections.</span>

<span class="sd">        Args:</span>
<span class="sd">            sections (list): List of sections to process, each represented as a dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Contains the results of the workflow, including success status, total processed,</span>
<span class="sd">            counts of completed, failed, and skipped sections, and processing duration.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the session is not found in Redis.</span>

<span class="sd">        Example:</span>
<span class="sd">            runner = GSPRGraphRunner(session_id=&quot;123&quot;, job_id=&quot;job_456&quot;, component_name=&quot;Sensor&quot;,</span>
<span class="sd">                                    requirement_sections={}, concurrency_limit=10)</span>
<span class="sd">            results = await runner.run_all_sections(sections=[{&quot;section&quot;: &quot;A&quot;}, {&quot;section&quot;: &quot;B&quot;}])</span>

<span class="sd">            Response:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;success&quot;: true,</span>
<span class="sd">                &quot;total_processed&quot;: 2,</span>
<span class="sd">                &quot;completed&quot;: 2,</span>
<span class="sd">                &quot;failed&quot;: 0,</span>
<span class="sd">                &quot;skipped&quot;: 0,</span>
<span class="sd">                &quot;duration&quot;: 1.23</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Getting session </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> from Redis...&quot;</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> not found in Redis.&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Session found, creating GSPRGraph for job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="c1"># Create GSPRGraph execution environment</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">GSPRGraph</span><span class="p">(</span>
            <span class="n">chain</span><span class="o">=</span><span class="n">GSPRChain</span><span class="p">(),</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">component_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="p">,</span>
            <span class="n">concurrency_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">concurrency_limit</span><span class="p">,</span>
            <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">requirement_sections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">requirement_sections</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] GSPRGraph created, running workflow for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> sections...&quot;</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run the full workflow: context -&gt; grouping -&gt; processing</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">sections</span><span class="o">=</span><span class="n">sections</span><span class="p">,</span>
                <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Workflow completed in </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s, processing results...&quot;</span><span class="p">)</span>

            <span class="c1"># Extract results for job progress update</span>
            <span class="n">group_results</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="p">[])</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Raw result keys: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Group results count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">group_results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Sample result: </span><span class="si">{</span><span class="n">group_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Update job progress based on results</span>
            <span class="c1"># Note: GSPR chain returns status as &quot;success&quot; or &quot;skipped&quot;, not &quot;completed&quot;</span>
            <span class="n">completed_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">])</span>
            <span class="n">failed_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">)</span>
            <span class="n">skipped_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;skipped&quot;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Final counts - completed/success: </span><span class="si">{</span><span class="n">completed_count</span><span class="si">}</span><span class="s2">, skipped: </span><span class="si">{</span><span class="n">skipped_count</span><span class="si">}</span><span class="s2">, failed: </span><span class="si">{</span><span class="n">failed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Determine if job was successful - no errors and some results processed</span>
            <span class="n">job_success</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

            <span class="c1"># Don&#39;t double-count progress - the individual sections already updated</span>
            <span class="c1"># Just mark the job as completed and publish final event</span>
            <span class="k">if</span> <span class="n">job_success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> marked as completed&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> marked as failed - Errors: </span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Return results with additional metadata</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="o">**</span><span class="n">result</span><span class="p">,</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">job_success</span><span class="p">,</span>
                <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">),</span>
                <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="n">completed_count</span><span class="p">,</span>
                <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="n">failed_count</span><span class="p">,</span>
                <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="n">skipped_count</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle bulk processing failure</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Bulk processing failed for job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">),</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="core.agent.gspr_tableAgent.GSPRGraphRunner.run_all_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_all_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Execute the LangGraph workflow for all sections.</p>
<p>This method processes all sections through the GSPRGraph pipeline, updates job progress,
and returns the results along with metadata such as processing duration and counts of
completed, failed, and skipped sections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sections</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of sections to process, each represented as a dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains the results of the workflow, including success status, total processed,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>counts of completed, failed, and skipped sections, and processing duration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the session is not found in Redis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>runner = GSPRGraphRunner(session_id="123", job_id="job_456", component_name="Sensor",
                        requirement_sections={}, concurrency_limit=10)
results = await runner.run_all_sections(sections=[{"section": "A"}, {"section": "B"}])</p>
<p>Response:
{
    "success": true,
    "total_processed": 2,
    "completed": 2,
    "failed": 0,
    "skipped": 0,
    "duration": 1.23
}</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>core/agent/gspr_tableAgent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_all_sections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute the LangGraph workflow for all sections.</span>

<span class="sd">    This method processes all sections through the GSPRGraph pipeline, updates job progress,</span>
<span class="sd">    and returns the results along with metadata such as processing duration and counts of</span>
<span class="sd">    completed, failed, and skipped sections.</span>

<span class="sd">    Args:</span>
<span class="sd">        sections (list): List of sections to process, each represented as a dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Contains the results of the workflow, including success status, total processed,</span>
<span class="sd">        counts of completed, failed, and skipped sections, and processing duration.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the session is not found in Redis.</span>

<span class="sd">    Example:</span>
<span class="sd">        runner = GSPRGraphRunner(session_id=&quot;123&quot;, job_id=&quot;job_456&quot;, component_name=&quot;Sensor&quot;,</span>
<span class="sd">                                requirement_sections={}, concurrency_limit=10)</span>
<span class="sd">        results = await runner.run_all_sections(sections=[{&quot;section&quot;: &quot;A&quot;}, {&quot;section&quot;: &quot;B&quot;}])</span>

<span class="sd">        Response:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;success&quot;: true,</span>
<span class="sd">            &quot;total_processed&quot;: 2,</span>
<span class="sd">            &quot;completed&quot;: 2,</span>
<span class="sd">            &quot;failed&quot;: 0,</span>
<span class="sd">            &quot;skipped&quot;: 0,</span>
<span class="sd">            &quot;duration&quot;: 1.23</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Getting session </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> from Redis...&quot;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_manager</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="si">}</span><span class="s2"> not found in Redis.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Session found, creating GSPRGraph for job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="c1"># Create GSPRGraph execution environment</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">GSPRGraph</span><span class="p">(</span>
        <span class="n">chain</span><span class="o">=</span><span class="n">GSPRChain</span><span class="p">(),</span>
        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="n">component_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="p">,</span>
        <span class="n">concurrency_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">concurrency_limit</span><span class="p">,</span>
        <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
        <span class="n">job_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span>
        <span class="n">requirement_sections</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">requirement_sections</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] GSPRGraph created, running workflow for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> sections...&quot;</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Run the full workflow: context -&gt; grouping -&gt; processing</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">sections</span><span class="o">=</span><span class="n">sections</span><span class="p">,</span>
            <span class="n">session_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Workflow completed in </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">s, processing results...&quot;</span><span class="p">)</span>

        <span class="c1"># Extract results for job progress update</span>
        <span class="n">group_results</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Raw result keys: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Group results count: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">group_results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Sample result: </span><span class="si">{</span><span class="n">group_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Update job progress based on results</span>
        <span class="c1"># Note: GSPR chain returns status as &quot;success&quot; or &quot;skipped&quot;, not &quot;completed&quot;</span>
        <span class="n">completed_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">])</span>
        <span class="n">failed_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;failed&quot;</span><span class="p">)</span>
        <span class="n">skipped_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">group_results</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;skipped&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Final counts - completed/success: </span><span class="si">{</span><span class="n">completed_count</span><span class="si">}</span><span class="s2">, skipped: </span><span class="si">{</span><span class="n">skipped_count</span><span class="si">}</span><span class="s2">, failed: </span><span class="si">{</span><span class="n">failed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Determine if job was successful - no errors and some results processed</span>
        <span class="n">job_success</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="c1"># Don&#39;t double-count progress - the individual sections already updated</span>
        <span class="c1"># Just mark the job as completed and publish final event</span>
        <span class="k">if</span> <span class="n">job_success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> marked as completed&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2"> marked as failed - Errors: </span><span class="si">{</span><span class="n">errors</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Return results with additional metadata</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="n">result</span><span class="p">,</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="n">job_success</span><span class="p">,</span>
            <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_results</span><span class="p">),</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="n">completed_count</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="n">failed_count</span><span class="p">,</span>
            <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="n">skipped_count</span><span class="p">,</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle bulk processing failure</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GSPRGraphRunner] Bulk processing failed for job </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">job_manager</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">job_id</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
            <span class="s2">&quot;total_processed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;failed&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">),</span>
            <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h2 id="regulatory-guard-agent-rule-based-safety-compliance-validation">üõ°Ô∏è  Regulatory Guard Agent ‚Äî Rule-Based Safety &amp; Compliance Validation</h2>
<p>Acts as a security and compliance layer across the pipeline.<br />
Enforces regulatory logic, validates inputs/outputs, and prevents inconsistent or unsafe data from propagating ‚ö†Ô∏èüõ°Ô∏è.</p>


<div class="doc doc-object doc-module">



<a id="core.agent.regulatory_guard_agent"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="core.agent.regulatory_guard_agent.system_instructions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">system_instructions</span> <span class="o">=</span> <span class="s1">&#39;You are a regulatory intelligence assistant. You analyze and generate compliance-related content only. Do not produce personal, political, or emotional commentary.&#39;</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve the regulatory guard agent instance.</p>
<p>This function initializes and returns a regulatory guard agent configured with the
current model, system prompt, and middleware. The agent is designed to analyze and
generate compliance-related content while adhering to regulatory constraints.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Agent</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A regulatory guard agent instance configured with the selected model,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>system prompt, and middleware.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>agent = get_regulatory_guard_agent()
response = agent.run("Analyze compliance for medical device X.")</p>
</details>
    </div>

</div>




<div class="doc doc-object doc-function">


<h2 id="core.agent.regulatory_guard_agent.get_regulatory_guard_agent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_regulatory_guard_agent</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get regulatory guard agent with current model selection.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>core/agent/regulatory_guard_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_regulatory_guard_agent</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get regulatory guard agent with current model selection.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">create_agent</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">get_vllm_llm</span><span class="p">(),</span>
        <span class="n">system_prompt</span><span class="o">=</span><span class="n">GUARD_PROMPT</span> <span class="ow">or</span> <span class="n">system_instructions</span><span class="p">,</span>
        <span class="n">middleware</span><span class="o">=</span><span class="n">get_regulatory_middlewares</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
